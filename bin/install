#!/usr/bin/env sh
set -eu
export LC_ALL=C
export LANG=C
IFS="$(printf " \t\nx")"

XDG_CONFIG_HOME="${HOME}/.config"
GHQ_ROOT="${HOME}/repo"
REPO_ROOT="${GHQ_ROOT}/github.com/diohabara/mac-dotfiles"
DOTFILES_HOME="${REPO_ROOT}/dotfiles"

function command_exists() {
  type "$1" &> /dev/null ;
}

function installing() {
  echo "Installing $1..."
}

function installed() {
  echo "$1 is installed!"
}

: "install brew" && {
  if ! command_exists brew; then
    echo "Install brew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install.sh)"
  else
    echo "brew is already installed"
  fi
}

: "install packages by brew" && {
  echo "Install packages by brew..."
  brew bundle install --file "${REPO_ROOT}/.Brewfile"
}

: "install other packages" && {
  installing 'poetry'
  curl -sSL https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python
  installed 'poetry'
  
  installing 'pip'
  curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py
  python get-pip.py
  rm get-pip.py
  installed 'pip'
  
  installing 'Rust'
  curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh -s -- -y
  installed 'Rust'
  
  installing 'Haskell'
  curl -sSL https://get.haskellstack.org/ | sh
  installed 'Haskell'
}

echo "Complete instalation.!"
